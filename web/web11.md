# Web逻辑越权 1

## 越权：水平越权，垂直越权

登录：暴力破解，本地加密传输，Cookie脆弱，Session劫持，密文对比认证

业务：订单ID，手机号码，用户ID，商品ID，其他

验证：暴力破解，绕过测试，自动识别

数据：支付篡改，数量篡改，请求重放，其他

找回：客户端回显，Response状态值，Session覆盖，弱Token缺陷，找回流程绕过，其他

接口：调用遍历，参数篡改，未授权访问，webservice测试，callback自定义

回退：回退重放

tips：在检测越权的时候，要多观察数据包的凭证，有时一个凭证是不够的，比如说虽然访问到界面了，却没有实际操作的权限（提示权限不足），可以多抓几个包

tips：在检测垂直越权的时候，可以在本地搭建一个环境，然后抓取管理员的数据包，再把本地环境的管理员凭证，放到真实环境里测试



垂直越权：添加用户

前提条件：获取到添加用户的数据包

1.普通用户前端有操作界面可以抓取数据包

2.通过网站源码本地搭建自己去模拟抓取

3.盲猜

水平，垂直越权，未授权访问：

通过更换身份标识，能够访问其他账号的数据

通过低权限账号发送高权限账号才能有的请求，获得其高权限的操作

通过删除请求中的认证信息后重放该请求，依旧可以访问或者完成操作

### 修复/防御：

前后端同时进行输入校验，双重验证机制

调用功能前验证是否有权调用

执行关键操作前必须验证用户身份，验证用户是否具备操作数据的权限

直接对象引用的加密资源id，防止攻击者枚举id，敏感数据特殊化处理

永远不要相信来自用户的输入，对于可控参数进行严格检查与过滤

测试工具：小米范，Burp的Authz插件



## 关于登录安全：
有时密码直接在前端加密然后再提交，可能是md5一类的形式，因此爆破也需要对payload进行相应的加密（burp的payload设置的Payload Processing功能提供了hash加密的能力）

<https://github.com/huyuanzhi2/password_brute_dictionary>

用来爆破的弱口令字典

在白盒情况下，可以尝试找出Cookie脆弱点，如果Cookie判断上存在缺陷，可以构造出payload绕过验证
